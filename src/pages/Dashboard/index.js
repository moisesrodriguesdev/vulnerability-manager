import React, { useState, useEffect } from "react";
import { useHistory } from "react-router-dom";
import Card from "./../../Components/Card";
import api from "./../../services/api";
import { Chart } from "react-google-charts";
import Navbar from "./../../Components/NavBar";
import "./styles.css";

const Dashboard = () => {
  const history = useHistory();

  const [assets, setAssets] = useState(0);
  const [vulnerability, setVulnerability] = useState(0);
  const [riskMedium, setRiskMedium] = useState(0);
  const [dataChartsSeverity, setDataChartsSeverity] = useState({
    Linguagens: "Quantidade",
  });

  const [dataTopHost, setDataTopHost] = useState([{ Hosts: "Quantidade" }]);

  const token = "Token 91f052c60fe5c0c4b6fa323e6bb050c8eef2de68";
  const sanitizeDataChartsSeverity = Object.entries(dataChartsSeverity);
  // const sanitizeDataTop = Object.entries(dataTopHost);

  useEffect(() => {
    async function getHosts() {
      const response = await api.get("dashboard/cards/asset", {
        headers: {
          Authorization: token,
        },
      });
      setAssets(response.data);
    }

    getHosts();
  }, []);

  useEffect(() => {
    async function getVulnerability() {
      const response = await api.get("dashboard/cards/vulnerability", {
        headers: {
          Authorization: token,
        },
      });
      setVulnerability(response.data);
    }

    getVulnerability();
  }, []);

  useEffect(() => {
    async function getRiskMedium() {
      const response = await api.get("dashboard/cards/risk", {
        headers: {
          Authorization: token,
        },
      });
      setRiskMedium(response.data);
    }

    getRiskMedium();
  }, []);

  useEffect(() => {
    async function getChartsSeverity() {
      const response = await api.get("dashboard/charts/severity", {
        headers: {
          Authorization: token,
        },
      });
      setDataChartsSeverity({ ...dataChartsSeverity, ...response.data });
    }

    getChartsSeverity();
  }, []);

  // useEffect(() => {
  //   async function getTopHost() {
  //     const response = await api.get("dashboard/charts/top-assets", {
  //       headers: {
  //         Authorization: token,
  //       },
  //     });
  //     // const { host, vuln_count } = response.data;
  //     // console.log(host, vuln_count);
  //     setDataTopHost({ ...dataTopHost, ...response.data });
  //   }

  //   getTopHost();
  // }, []);

  // console.log(sanitizeDataTop);
  const tes = Object.entries(dataTopHost);
  console.log(tes);
  return (
    <>
      <Navbar />
      <div className="content content-dashboard">
 
        <div className="row">
          <Card data={assets.asset_count} title="Qtd. Hosts" />
          <Card
            data={assets.vulnerable_asset_count}
            title="Qtd. Hosts Vulneráveis"
          />
          <Card
            data={vulnerability.vuln_count}
            title="Total de vulnerabilidades"
          />
          <Card
            data={vulnerability.active_vuln_count}
            title="Total de vulnerabilidades não corrigidas"
          />
          <Card data={riskMedium.risk_avg} title="Média de risco dos hosts" />
        </div>


      <div className="chart-box">
        <div className="chart-content">
          <Chart
            width={"500px"}
            height={"300px"}
            chartType="PieChart"
            data={sanitizeDataChartsSeverity}
            options={{ title: "Vulnerabilidades não corrigidas" }}
          />
        </div>

        {/* <div className="chart-content">
          <Chart
            width={"500px"}
            height={"300px"}
            chartType="PieChart"
            data={sanitizeDataTop}
            options={{ title: "Top 10 Hosts mais vulneráveis" }}
          />
        </div> */}
      </div>
      </div>
      
    </>
  );
};

export default Dashboard;
