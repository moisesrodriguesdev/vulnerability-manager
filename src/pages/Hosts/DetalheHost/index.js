import React, { useState, useEffect, useContext } from "react";
import api from "./../../../services/api";
import Navbar from "./../../../Components/NavBar";
import StoreContextApi from "./../../../Components/Store/ContextApi";
import "./styles.css";

const DetalheHost = (props) => {
  const { id } = props.computedMatch.params;
  const { token } = useContext(StoreContextApi);
  const [detailsAssets, setDetailsAssets] = useState({});
  const [assetVulnTotal, setAssetVulnTotal] = useState([]);
  const [vulnFixed, setVulnFixed] = useState([]);

  useEffect(() => {
    async function getDetailsAssets() {
      const response = await api.get(`assets/${id}`, {
        headers: {
          Authorization: `Token ${token}`,
        },
      });
      setDetailsAssets(response.data);
      setAssetVulnTotal(response.data.vuln);
      setVulnFixed(response.data.vuln_fixed);
    }
    getDetailsAssets();
  }, []);
  console.log();
  return (
    <>
      <Navbar />
      <div className="content">
        <div className="details-assets">
          <div className="details-item">
            <p>HostName</p>
            <span>{detailsAssets.hostname}</span>
          </div>
          <div>
            <p>Endereço IP</p>
            <span>{detailsAssets.ip_address}</span>
          </div>
          <div className="details-item">
            <p>Risco</p>
            <span>{detailsAssets.risk}</span>
          </div>
          <div>
            <p>Qtd. Vulnerabilidades não corrigidas</p>
            <span>{detailsAssets.vuln_count}</span>
          </div>
          <div className="content-assets-vuln">
            <p>Vulnerabilidades não corrigidas</p>
            <div className="assets-vuln">
              {assetVulnTotal.map((vuln) => (
                <span>{vuln}</span>
              ))}
            </div>
          </div>
          <div>
            <p>Vulnerabilidades corrigidas</p>
            <div className="assets-vuln">
              {vulnFixed.map((vulnFixed) => (
                <span>{vulnFixed}</span>
              ))}
            </div>
          </div>
        </div>
      </div>
    </>
  );
};

export default DetalheHost;
